<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bridge Capacity Calculator</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <style>
    body { background-color: #e3f2fd; }
    .container { margin-top: 30px; }
    .remove-btn { background-color: red; color: white; border: none; }
    .remove-btn:hover { background-color: darkred; }
  </style>
  <script>
    // Toggle between steel and concrete input fields
    function updateMaterialOptions() {
      var material = document.getElementById("material").value;
      document.getElementById("steel-options").classList.add("d-none");
      document.getElementById("concrete-options").classList.add("d-none");
      if (material === "Steel") {
        document.getElementById("steel-options").classList.remove("d-none");
      } else if (material === "Concrete") {
        document.getElementById("concrete-options").classList.remove("d-none");
      }
    }
    // Toggle loaded carriageway inputs based on loading type (HA/HB)
    function updateLoadingTypeOptions() {
      var loadingType = document.getElementById("loading_type").value;
      if (loadingType === "HA" || loadingType === "HB") {
        document.getElementById("loaded-access-group").style.display = "block";
      } else {
        document.getElementById("loaded-access-group").style.display = "none";
      }
    }
    // Add a new row for an additional load
    function addLoad() {
      var table = document.getElementById("loadTable").getElementsByTagName('tbody')[0];
      var row = table.insertRow();
      row.innerHTML = `
        <td><input type="text" class="form-control" name="load_desc[]" required></td>
        <td><input type="number" step="0.1" class="form-control" name="load_value[]" required></td>
        <td>
          <select class="form-control" name="load_type[]">
            <option value="dead">Dead Load</option>
            <option value="live">Live Load</option>
          </select>
        </td>
        <td>
          <select class="form-control" name="load_distribution[]">
            <option value="udl">UDL</option>
            <option value="point">Point</option>
          </select>
        </td>
        <td><button type="button" class="btn btn-danger remove-btn" onclick="removeLoad(this)">Remove</button></td>
      `;
    }
    // Remove an additional load row
    function removeLoad(button) {
      var row = button.parentNode.parentNode;
      row.parentNode.removeChild(row);
    }
    window.onload = function() {
      updateMaterialOptions();
      updateLoadingTypeOptions();
    }
  </script>
</head>
<body>
  <div class="container">
    <!-- Main Form Card -->
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h2>Bridge Capacity Calculator</h2>
      </div>
      <div class="card-body">
        <form action="/calculate" method="post">
          <!-- [All your existing form fields remain unchanged] -->
          <!-- Bridge Type, Span, Effective Member Length, Material, Steel/Concrete options, Loading Type, etc. -->
          <!-- For HA/HB loading -->
          <div id="loaded-access-group">
            <div class="form-group">
              <label for="loaded_width">Loaded Carriageway Width (m):</label>
              <input type="number" step="0.1" class="form-control" name="loaded_width" id="loaded_width" placeholder="e.g., 3.43">
            </div>
            <div class="form-group">
              <label for="access_type">Access Type:</label>
              <select class="form-control" name="access_type" id="access_type">
                <option value="Company">Company (×1.3)</option>
                <option value="Public">Public (×1.5)</option>
              </select>
            </div>
          </div>
          <!-- For HA loading, lane width input -->
          <div class="form-group" id="lane-width-group">
            <label for="lane_width">Lane Width (m):</label>
            <input type="number" step="0.1" class="form-control" name="lane_width" id="lane_width" placeholder="e.g., 3.65">
          </div>
          <div class="form-group">
            <label for="condition_factor">Member Condition Factor:</label>
            <input type="number" step="0.01" class="form-control" name="condition_factor" id="condition_factor" required>
          </div>
          
          <!-- Additional Loads Section -->
          <div class="card mt-4">
            <div class="card-header">
              <h4>Additional Loads</h4>
            </div>
            <div class="card-body">
              <table class="table table-bordered" id="loadTable">
                <thead>
                  <tr>
                    <th>Description</th>
                    <th>Value (kN)</th>
                    <th>Type</th>
                    <th>Distribution</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Rows added dynamically -->
                </tbody>
              </table>
              <button type="button" class="btn btn-secondary" onclick="addLoad()">+ Add Load</button>
            </div>
          </div>
          <button type="submit" class="btn btn-primary btn-block mt-4">Calculate</button>
        </form>
      </div>
    </div>

    {% if result %}
      <!-- Summary Table: Highlighting Main Results -->
      <div class="card mt-4">
        <div class="card-header bg-warning text-white">
          <h3>Summary</h3>
        </div>
        <div class="card-body">
          <table class="table table-bordered">
            <tr>
              <th>Beam Moment Capacity (kNm)</th>
              <td>{{ result["Moment Capacity (kNm)"] }}</td>
            </tr>
            <tr>
              <th>Applied Live Load Moment (kNm)</th>
              <td>{{ result["Applied Live Load Moment (kNm)"] }}</td>
            </tr>
            <tr>
              <th>Applied Dead Load Moment (kNm)</th>
              <td>{{ result["Applied Dead Load Moment (kNm)"] }}</td>
            </tr>
          </table>
        </div>
      </div>

      <!-- Detailed Results (Collapsible) -->
      <button class="btn btn-secondary mt-3" type="button" data-toggle="collapse" data-target="#detailedResults" aria-expanded="false" aria-controls="detailedResults">
        Show Detailed Results
      </button>
      <div class="collapse" id="detailedResults">
        <div class="card card-body mt-3">
          <pre>{{ result|tojson(indent=2) }}</pre>
        </div>
      </div>

      <!-- Full Results Table -->
      <div class="card mt-4">
        <div class="card-header bg-success text-white">
          <h3>Calculation Results</h3>
        </div>
        <div class="card-body">
          <table class="table table-striped">
            <tbody>
              {% for key, value in result.items() if key not in ["Applied Live Load Moment (kNm)", "Applied Dead Load Moment (kNm)", "Moment Capacity (kNm)"] %}
              <tr>
                <th>{{ key }}</th>
                <td>{{ value }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    {% endif %}
  </div>

  <!-- Bootstrap JS and dependencies -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
